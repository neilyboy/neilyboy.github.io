<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fiber Layout Manager</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 1000px;
            margin: auto;
            background: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
        }
        input, select, button {
            margin: 5px 0;
            padding: 8px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Fiber Layout Manager</h1>
        
        <h2>Add Vault Location</h2>
        <input type="text" id="vaultAddress" placeholder="Vault Address">
        <select id="fiberGroup">
            <option value="1">Group 1 (1-144)</option>
            <option value="2">Group 2 (145-288)</option>
            <option value="3">Group 3 (289-432)</option>
        </select>
        <input type="number" id="startFiber" placeholder="Start Fiber">
        <input type="number" id="endFiber" placeholder="End Fiber">
        <button onclick="addVault()">Add Vault</button>
        
        <h2>Vault Locations</h2>
        <table id="vaultTable">
            <thead>
                <tr>
                    <th>Vault Address</th>
                    <th>Fiber Group</th>
                    <th>Fiber Range</th>
                </tr>
            </thead>
            <tbody id="vaultBody"></tbody>
        </table>
        
        <h2>Add Address</h2>
        <select id="vaultSelect"></select>
        <input type="text" id="addressName" placeholder="Address Name">
        <select id="fiberSelect"></select>
        <button onclick="addAddress()">Add Address</button>
        
        <h2>Addresses and Services</h2>
        <table id="addressTable">
            <thead>
                <tr>
                    <th>Address</th>
                    <th>Vault</th>
                    <th>Fiber</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="addressBody"></tbody>
        </table>
        
        <button onclick="exportToExcel()" style="margin-top: 20px;">Export to Excel</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script>
        let vaults = [];
        let addresses = [];

        function addVault() {
            const address = document.getElementById('vaultAddress').value;
            const group = document.getElementById('fiberGroup').value;
            const startFiber = parseInt(document.getElementById('startFiber').value);
            const endFiber = parseInt(document.getElementById('endFiber').value);
            
            if (address && group && startFiber && endFiber) {
                vaults.push({ address, group, startFiber, endFiber });
                updateVaultTable();
                updateVaultSelect();
                clearVaultInputs();
            }
        }

        function updateVaultTable() {
            const tbody = document.getElementById('vaultBody');
            tbody.innerHTML = '';
            vaults.forEach(vault => {
                const row = tbody.insertRow();
                row.insertCell(0).textContent = vault.address;
                row.insertCell(1).textContent = `Group ${vault.group}`;
                row.insertCell(2).textContent = `${vault.startFiber} - ${vault.endFiber}`;
            });
        }

        function updateVaultSelect() {
            const select = document.getElementById('vaultSelect');
            select.innerHTML = '<option value="">Select Vault</option>';
            vaults.forEach((vault, index) => {
                select.innerHTML += `<option value="${index}">${vault.address}</option>`;
            });
        }

        function clearVaultInputs() {
            document.getElementById('vaultAddress').value = '';
            document.getElementById('fiberGroup').selectedIndex = 0;
            document.getElementById('startFiber').value = '';
            document.getElementById('endFiber').value = '';
        }

        function updateFiberSelect() {
            const vaultIndex = document.getElementById('vaultSelect').value;
            const fiberSelect = document.getElementById('fiberSelect');
            fiberSelect.innerHTML = '<option value="">Select Fiber</option>';
            
            if (vaultIndex !== "") {
                const vault = vaults[vaultIndex];
                for (let i = vault.startFiber; i <= vault.endFiber; i++) {
                    fiberSelect.innerHTML += `<option value="${i}">${i}</option>`;
                }
            }
        }

        document.getElementById('vaultSelect').addEventListener('change', updateFiberSelect);

        function addAddress() {
            const vaultIndex = document.getElementById('vaultSelect').value;
            const name = document.getElementById('addressName').value;
            const fiber = document.getElementById('fiberSelect').value;
            
            if (vaultIndex !== "" && name && fiber) {
                const vault = vaults[vaultIndex];
                addresses.push({ name, vault: vault.address, fiber });
                updateAddressTable();
                clearAddressInputs();
            }
        }

        function updateAddressTable() {
            const tbody = document.getElementById('addressBody');
            tbody.innerHTML = '';
            addresses.forEach((address, index) => {
                const row = tbody.insertRow();
                row.insertCell(0).textContent = address.name;
                row.insertCell(1).textContent = address.vault;
                row.insertCell(2).textContent = address.fiber;
                const actionCell = row.insertCell(3);
                actionCell.innerHTML = `<button onclick="addService(${index})">Add Service</button>`;
            });
        }

        function clearAddressInputs() {
            document.getElementById('vaultSelect').selectedIndex = 0;
            document.getElementById('addressName').value = '';
            document.getElementById('fiberSelect').innerHTML = '<option value="">Select Fiber</option>';
        }

        function addService(index) {
            const serviceName = prompt("Enter service name:");
            if (serviceName) {
                if (!addresses[index].services) {
                    addresses[index].services = [];
                }
                addresses[index].services.push(serviceName);
                updateAddressTable();
            }
        }

        function exportToExcel() {
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(addresses);
            XLSX.utils.book_append_sheet(wb, ws, "Fiber Layout");
            XLSX.writeFile(wb, "fiber_layout.xlsx");
        }
    </script>
</body>
</html>
